<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events - Nepo Chat</title>
    <style>
        body {
            background: #0e0e0e;
            color: white;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        h2 {
            color: #00ccff;
            text-shadow: 0 0 8px #00ccff;
        }
        button {
            padding: 14px;
            margin: 10px 0;
            border-radius: 6px;
            border: none;
            font-size: 18px;
            width: 240px;
            background: #00ccff;
            color: white;
            cursor: pointer;
            transition: background 0.3s ease;
            font-weight: bold;
        }
        button:hover {
            background: #0099cc;
        }
    </style>
</head>
<body>

    <h2>Exclusive Events</h2>
    <p>Join special events for just ₦100</p>

    <button id="buyEventBtn">Purchase Event Ticket</button>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCoRQZYMukYZoqkbY6q0heK3yO9zNFYUfE",
            authDomain: "nepo-chat.firebaseapp.com",
            databaseURL: "https://nepo-chat-default-rtdb.firebaseio.com",
            projectId: "nepo-chat",
            storageBucket: "nepo-chat.appspot.com",
            messagingSenderId: "75918244734",
            appId: "1:75918244734:web:33762641fba78c03a3912f",
            measurementId: "G-V22RDC8S2Z"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        const EVENT_COST = 100;

        document.getElementById("buyEventBtn").addEventListener("click", () => {
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    const balanceRef = ref(db, "users/" + user.uid + "/balance");

                    get(balanceRef).then(snapshot => {
                        let currentBalance = snapshot.val() || 0;

                        if (currentBalance >= EVENT_COST) {
                            set(balanceRef, currentBalance - EVENT_COST)
                                .then(() => {
                                    alert(`✅ Event ticket purchased! ₦${EVENT_COST} deducted.`);
                                })
                                .catch(err => {
                                    alert("❌ Error deducting balance: " + err.message);
                                });
                        } else {
                            alert(`❌ Not enough balance! You need ₦${EVENT_COST}, but only have ₦${currentBalance}`);
                        }
                    }).catch(err => {
                        alert("❌ Error reading balance: " + err.message);
                    });

                } else {
                    alert("⚠ Please log in first.");
                    window.location.href = "signin.html";
                }
            });
        });
    </script>

</body>
</html>
